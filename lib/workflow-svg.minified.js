"use strict";var WorkflowSVG=function(){function a(a,d){var f=a.group().attr({id:d.id});a.entities.push(f),d.backgroundcolor=d.backgroundcolor?d.backgroundcolor:"#f06",d.color=d.color?d.color:"#ffffff",d.radius=d.radius?d.radius:0,f.dragPoints=[],f.entity=f.rect(d.width,d.height).move(d.x,d.y).attr({fill:d.backgroundcolor}).radius(d.radius),d.class&&f.entity.attr("class",d.class),f.text(d.text).cx(d.x+d.width/2).cy(d.y+d.height/2).attr({fill:d.color}).font({family:"Helvetica"}),f.arrows=f.group();var g=f.rect(d.width+50,d.height+50).move(d.x-25,d.y-25).attr({opacity:"0",fill:"#FFBF00"});//dragabble area
// if hovering - show drag points
// if hovering outside - remove drag points (except the one selected)
f.dragGroup=f.group(),f.rect(d.width-50,d.height-50).move(d.x+25,d.y+25).attr({opacity:"0"}).draggable().on("dragmove.namespace",function(b){b.preventDefault();var e=b.detail.box;f.move(e.x-50,e.y-50),d.x=e.x-50,d.y=e.y-50,c(a,s)}).on("dragend",function(a){l("entity:moved",m(a))}).on("click",function(a){l("entity:clicked",m(a))}),g.on("mouseover",function(c){b(a,f,"top"),b(a,f,"right"),b(a,f,"bottom"),b(a,f,"left"),c.stopPropagation()}),a.on("mouseover",function(){f.dragPoints.forEach(function(a){r.includes(a)||a.remove()})})}function b(a,b,d){var e=h(b.entity,d),f=i(b.entity,d);b.dragPoints.push(b.dragGroup.circle(10,10).attr({fill:"white",stroke:"#d4d4d4",id:d}).move(e-5,f-5).on("mouseover",function(a){// make point bigger
this.transform({scale:2}),a.stopPropagation()}).on("click",function(){if(!!r.includes(this))r=[];else if(r.push(this),2==r.length){var b={id:"line-"+s.length,from:{element:r[0].parent().parent().attr("id"),point:r[0].attr("id")},to:{element:r[1].parent().parent().attr("id"),point:r[1].attr("id")}};s.push(b),q.lines.push(j(b)),c(a,s),r=[],l("line:added",b)}}).on("mouseout",function(a){r.includes(this)||this.transform({scale:1}),a.stopPropagation()}))}function c(a,b){b.forEach(function(b){return d(a,b)})}function d(a,b){var c="",d=q.configuration.line_color?q.configuration.line_color:"black",g=a.findOne("#"+b.from.element),j=a.findOne("#"+b.to.element),k=f(b,g,j);c+=h(g.entity,b.from.point)+","+i(g.entity,b.from.point)+" ",k.forEach(function(a){return c+=a.x+","+a.y+" "}),c+="top"===b.to.point?h(j.entity,b.to.point)+","+(i(j.entity,b.to.point)-5)+" ":"right"===b.to.point?h(j.entity,b.to.point)+5+","+i(j.entity,b.to.point)+" ":"bottom"===b.to.point?h(j.entity,b.to.point)+","+(i(j.entity,b.to.point)+5)+" ":h(j.entity,b.to.point)-5+","+i(j.entity,b.to.point)+" ";b.polyline?b.polyline.plot(c):b.polyline=a.lines.polyline(c).fill("none").stroke({color:d,width:4,linecap:"round",linejoin:"round"}).on("click",function(a){l("line:clicked",a.target.id)}).attr("id",b.id);e(b,j,d)}function e(a,b,c){if(!a.to.arrow&&"default"===q.configuration.arrow_type){var d=h(b.entity,a.to.point)+","+i(b.entity,a.to.point)+" ";"top"===a.to.point?(d+=h(b.entity,a.to.point)+7+","+(i(b.entity,a.to.point)-14)+" ",d+=h(b.entity,a.to.point)-7+","+(i(b.entity,a.to.point)-14)+" "):"right"===a.to.point?(d+=h(b.entity,a.to.point)+14+","+(i(b.entity,a.to.point)-7)+" ",d+=h(b.entity,a.to.point)+14+","+(i(b.entity,a.to.point)+7)+" "):"bottom"===a.to.point?(d+=h(b.entity,a.to.point)+7+","+(i(b.entity,a.to.point)+14)+" ",d+=h(b.entity,a.to.point)-7+","+(i(b.entity,a.to.point)+14)+" "):(d+=h(b.entity,a.to.point)-14+","+(i(b.entity,a.to.point)-7)+" ",d+=h(b.entity,a.to.point)-14+","+(i(b.entity,a.to.point)+7)+" "),a.to.arrow=b.arrows.polygon(d).fill(c).stroke({width:1})}}function f(a,b,c){var d=[],e=i(b.entity,a.from.point),f=i(c.entity,a.to.point),j=h(b.entity,a.from.point),k=h(c.entity,a.to.point),l=g(a.from.point),m=g(a.to.point),n=l-m;return 0===n&&("top"===a.from.point?e<=f?(d.push({x:j,y:e-20}),d.push({x:k,y:e-20})):(d.push({x:j,y:f-20}),d.push({x:k,y:f-20})):"bottom"===a.from.point?e<=f?(d.push({x:j,y:f+20}),d.push({x:k,y:f+20})):(d.push({x:j,y:e+20}),d.push({x:k,y:e+20})):"left"===a.from.point?j<=k?(d.push({x:j-20,y:e}),d.push({x:j-20,y:f})):(d.push({x:k-20,y:e}),d.push({x:k-20,y:f})):j<=k?(d.push({x:k+20,y:e}),d.push({x:k+20,y:f})):(d.push({x:j+20,y:e}),d.push({x:j+20,y:f}))),(2===n||-2===n)&&("left"===a.from.point||"right"===a.from.point?e!==f&&(d.push({x:j+(k-j)/2,y:e}),d.push({x:j+(k-j)/2,y:f})):j!==k&&(d.push({x:j,y:f+(e-f)/2}),d.push({x:k,y:f+(e-f)/2}))),(1===n||-1===n||3===n||-3===n)&&("top"===a.from.point&&(e<=f?(d.push({x:j,y:e-20}),"left"===a.to.point?(d.push({x:k-20,y:e-20}),d.push({x:k-20,y:f})):(d.push({x:k+20,y:e-20}),d.push({x:k+20,y:f}))):d.push({x:j,y:f})),"bottom"===a.from.point&&(e>=f?(d.push({x:j,y:e+20}),"left"===a.to.point?(d.push({x:k-20,y:e+20}),d.push({x:k-20,y:f})):(d.push({x:k+20,y:e+20}),d.push({x:k+20,y:f}))):d.push({x:j,y:f})),"left"===a.from.point&&(e>f?"top"===a.to.point?(d.push({x:j-20,y:e}),d.push({x:j-20,y:f-20}),d.push({x:k,y:f-20})):d.push({x:k,y:e}):"top"===a.to.point?d.push({x:k,y:e}):(d.push({x:j-20,y:e}),d.push({x:j-20,y:f+20}),d.push({x:k,y:f+20}))),"right"===a.from.point&&(e>f?"top"===a.to.point?(d.push({x:j+20,y:e}),d.push({x:j+20,y:f-20}),d.push({x:k,y:f-20})):d.push({x:k,y:e}):"top"===a.to.point?d.push({x:k,y:e}):(d.push({x:j+20,y:e}),d.push({x:j+20,y:f+20}),d.push({x:k,y:f+20})))),d}function g(a){return"top"===a?0:"right"===a?1:"bottom"===a?2:3}function h(a,b){return"right"===b?a.attr("width")+a.attr("x"):"top"===b?a.attr("width")/2+a.attr("x"):"bottom"===b?a.attr("width")/2+a.attr("x"):a.attr("x")}function i(a,b){return"right"===b?a.attr("height")/2+a.attr("y"):"top"===b?a.attr("y"):"bottom"===b?a.attr("height")+a.attr("y"):a.attr("height")/2+a.attr("y")}function j(a){return JSON.parse(JSON.stringify(a))}function k(){p.entities.forEach(function(a){return a.remove()}),p.entities=[],s.forEach(function(a){return a.remove()}),s=[],r=[],q.entities.forEach(function(b){return a(p,b)}),s=j(q.lines),c(p,s)}function l(a,b){null!==u[a]&&u[a]!==void 0&&u[a].forEach(function(a){return a(b)})}function m(a){var b="";return a&&a.target&&a.target.parentElement&&(b=a.target.parentElement.id),b}function n(a){q=j(a),t?k():SVG.on(document,"DOMContentLoaded",function(){k(),t=!0})}function o(){return q}var p,q={entities:[]},r=[],s=[],t=!1,u={};return{initalize:function(a,b,c){SVG.on(document,"DOMContentLoaded",function(){p=SVG().addTo(a).size(b,c),p.entities=[],p.lines=p.group()})},update:n,register:function(a,b){(null===u[a]||u[a]===void 0)&&(u[a]=[]),u[a].push(b)},get:o}};
